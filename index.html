<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preferred Stocks Correlation Matrix</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header p { font-size: 1.1em; color: #b8c5d6; }
        .controls, .api-setup, .matrix-container, .info-panel {
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .control-row { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; }
        .control-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-weight: 600; color: #e0e6ed; font-size: 0.9em; }
        select, input {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 14px;
            min-width: 150px;
        }
        select:focus, input:focus { outline: none; box-shadow: 0 0 0 2px #00d4ff; }
        .btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .matrix-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .matrix-table th, .matrix-table td { padding: 12px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1); font-weight: 500; }
        .matrix-table th { background: linear-gradient(45deg, #00d4ff22, #00ff8822); }
        .correlation-cell { font-weight: 600; border-radius: 6px; transition: all 0.3s ease; cursor: pointer; }
        .correlation-cell:hover { transform: scale(1.1); z-index: 10; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); }
        .legend { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.9em; }
        .legend-color { width: 20px; height: 20px; border-radius: 4px; border: 1px solid rgba(255, 255, 255, 0.3); }
        .loading { text-align: center; padding: 40px; font-size: 1.2em; color: #b8c5d6; }
        .error, .success { padding: 15px; border-radius: 8px; margin: 20px 0; }
        .error { background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.3); color: #ff6b6b; }
        .success { background: rgba(0, 255, 0, 0.1); border: 1px solid rgba(0, 255, 0, 0.3); color: #00ff88; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .stat-card { background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 1.5em; font-weight: bold; margin-bottom: 5px; }
        .stat-label { font-size: 0.9em; color: #b8c5d6; }
        .api-status { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-online { background-color: #00ff88; }
        .status-offline { background-color: #ff4757; }
        .status-loading { background-color: #fdcb6e; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* YENİ: Analiz Paneli Stilleri */
        #pairAnalysisContainer {
            display: grid;
            grid-template-columns: 1fr 1.5fr; /* Sol: Grafik, Sağ: Veriler */
            gap: 25px;
            align-items: flex-start;
            margin-top: 20px;
        }
        .price-chart-container svg { width: 100%; height: auto; border-radius: 8px; background: rgba(0,0,0,0.2); }
        .stock-details-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .details-column h5 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1em;
            padding-bottom: 10px;
            border-bottom: 2px solid;
        }
        .details-column .detail-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .detail-item .label { color: #b8c5d6; }
        .detail-item .value { font-weight: bold; }
        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.2);
            border-left-color: #00d4ff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 992px) {
            #pairAnalysisContainer { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .control-row { flex-direction: column; align-items: stretch; }
            .stock-details-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Preferred Stocks Correlation Matrix</h1>
            <p>Real-time correlation analysis with live market data</p>
        </div>

        <div class="api-setup">
            <h3 style="color: #00ff88; margin-bottom: 10px;">
                <span class="api-status status-online" id="apiStatus"></span>
                Yahoo Finance API - Real-Time Data
            </h3>
            <div class="api-input">
                <button class="btn" onclick="useRealData()">🚀 Use Real Market Data</button>
                <button class="btn" onclick="useDemoData()" style="background: linear-gradient(45deg, #6c5ce7, #fd79a8);">📊 Use Demo Data</button>
            </div>
            <div id="apiMessage" style="margin-top:15px;"></div>
        </div>

        <div class="controls">
            <div class="control-row">
                <div class="control-group"><label>Time Period</label><select id="timePeriod"><option value="30">30 Days</option><option value="60" selected>60 Days</option><option value="90">90 Days</option><option value="180">6 Months</option><option value="365">1 Year</option></select></div>
                <div class="control-group"><label>Custom Ticker</label><input type="text" id="customTicker" placeholder="e.g., BAC-PK"></div>
                <button class="btn" onclick="addCustomStock()">Add Stock</button>
                <button class="btn" id="refreshBtn" onclick="refreshMatrix()">Refresh Data</button>
            </div>
        </div>

        <div class="matrix-container">
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: #ff4757;"></div><span>Strong Neg</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #ff7675;"></div><span>Mod. Neg</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #fdcb6e;"></div><span>Weak</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #6c5ce7;"></div><span>Mod. Pos</span></div>
                <div class="legend-item"><div class="legend-color" style="background: #00b894;"></div><span>Strong Pos</span></div>
            </div>
            <div id="matrixContent"><div class="loading">Select data source and click "Refresh Data" to start...</div></div>
        </div>

        <div class="info-panel">
            <h3 style="color: #00d4ff;">Market Statistics</h3>
            <div class="stats" id="statsContainer"></div>
            <div style="margin-top: 25px;">
                <h4 style="color: #00ff88; margin-bottom: 10px;">Selected Pair Analysis</h4>
                <div id="pairAnalysis" style="color: #b8c5d6;">Click on a cell to see detailed analysis and financial data.</div>
            </div>
        </div>
    </div>

<script>
// --- App State ---
const appState = {
    useDemo: false,
    isApiReady: false,
    correlationMatrix: {},
    stockDataCache: {}, // For historical price data
    stockDetailsCache: {}, // For financial metrics
    preferredStocks: ['BAC-PK', 'JPM-PC', 'WFC-PQ', 'C-PN', 'GS-PK', 'MS-PI', 'USB-PH', 'PNC-PP']
};

// --- API & Data Fetching ---
const CORS_PROXY = "https://corsproxy.io/?";

async function fetchYahooAPI(url) {
    // ÇÖZÜM: Tüm istekler CORS Proxy üzerinden yapılır
    const response = await fetch(CORS_PROXY + encodeURIComponent(url));
    if (!response.ok) {
        throw new Error(`Yahoo API request failed: ${response.status} ${response.statusText}`);
    }
    return response.json();
}

async function fetchStockPriceData(symbol, period) {
    if (appState.useDemo) return generateDemoPriceData(period);
    
    try {
        const endDate = new Date();
        const startDate = new Date();
        startDate.setDate(endDate.getDate() - (parseInt(period) * 1.5));
        const startTimestamp = Math.floor(startDate.getTime() / 1000);
        const endTimestamp = Math.floor(endDate.getTime() / 1000);
        
        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?period1=${startTimestamp}&period2=${endTimestamp}&interval=1d`;
        const data = await fetchYahooAPI(url);
        
        if (!data.chart?.result?.[0]?.timestamp) return null;
        
        const { timestamp, indicators } = data.chart.result[0];
        const prices = indicators.quote[0].close;
        
        const timeSeries = timestamp
            .map((ts, i) => ({ timestamp: ts * 1000, price: prices[i] }))
            .filter(d => d.price !== null && d.price !== undefined);

        return timeSeries.length > 5 ? timeSeries : null;
    } catch (error) {
        console.warn(`Error fetching price data for ${symbol}:`, error);
        return null;
    }
}

// YENİ: Detaylı finansal verileri çeken fonksiyon
async function fetchStockDetails(symbol) {
    if (appState.stockDetailsCache[symbol]) return appState.stockDetailsCache[symbol];
    if (appState.useDemo) return generateDemoDetails(symbol);

    try {
        const modules = 'price,summaryDetail,defaultKeyStatistics';
        const url = `https://query2.finance.yahoo.com/v10/finance/quoteSummary/${symbol}?modules=${modules}`;
        const data = await fetchYahooAPI(url);
        
        const result = data.quoteSummary.result[0];
        appState.stockDetailsCache[symbol] = result;
        return result;
    } catch (error) {
        console.warn(`Error fetching details for ${symbol}:`, error);
        return null;
    }
}

// --- Calculation Engine (Improved) ---
function alignDataForCorrelation(data1, data2) {
    const map1 = new Map(data1.map(d => [new Date(d.timestamp).toDateString(), d.price]));
    const alignedPrices1 = [], alignedPrices2 = [];
    for (const item2 of data2) {
        const dateString = new Date(item2.timestamp).toDateString();
        if (map1.has(dateString)) {
            alignedPrices1.push(map1.get(dateString));
            alignedPrices2.push(item2.price);
        }
    }
    return { prices1: alignedPrices1, prices2: alignedPrices2 };
}
function calculateReturns(prices) {
    const returns = [];
    for (let i = 1; i < prices.length; i++) {
        if (prices[i-1] === 0) continue;
        returns.push((prices[i] - prices[i-1]) / prices[i-1]);
    }
    return returns;
}
function calculateCorrelation(prices1, prices2) {
    const returns1 = calculateReturns(prices1);
    const returns2 = calculateReturns(prices2);
    const n = Math.min(returns1.length, returns2.length);
    if (n < 2) return 0;
    const mean1 = returns1.reduce((a, b) => a + b) / n;
    const mean2 = returns2.reduce((a, b) => a + b) / n;
    let num = 0, den1 = 0, den2 = 0;
    for (let i = 0; i < n; i++) {
        const diff1 = returns1[i] - mean1;
        const diff2 = returns2[i] - mean2;
        num += diff1 * diff2;
        den1 += diff1 * diff1;
        den2 += diff2 * diff2;
    }
    const denominator = Math.sqrt(den1 * den2);
    return denominator === 0 ? 0 : num / denominator;
}

// --- Core App Logic ---
async function createCorrelationMatrix() {
    const period = document.getElementById('timePeriod').value;
    const stocks = [...appState.preferredStocks];
    
    updateApiStatus('loading');
    document.getElementById('matrixContent').innerHTML = '<div class="loading">Fetching market data...</div>';
    
    try {
        appState.stockDataCache = {};
        for (let i = 0; i < stocks.length; i++) {
            const symbol = stocks[i];
            document.getElementById('matrixContent').innerHTML = `<div class="loading">📈 Fetching ${symbol}... (${i+1}/${stocks.length})</div>`;
            appState.stockDataCache[symbol] = await fetchStockPriceData(symbol, period);
        }

        document.getElementById('matrixContent').innerHTML = '<div class="loading">🧮 Calculating correlations...</div>';
        const validStocks = stocks.filter(s => appState.stockDataCache[s]);
        appState.correlationMatrix = {};
        validStocks.forEach(stock1 => {
            appState.correlationMatrix[stock1] = {};
            validStocks.forEach(stock2 => {
                if (stock1 === stock2) {
                    appState.correlationMatrix[stock1][stock2] = 1.0;
                } else {
                    const { prices1, prices2 } = alignDataForCorrelation(appState.stockDataCache[stock1], appState.stockDataCache[stock2]);
                    const corr = calculateCorrelation(prices1, prices2);
                    appState.correlationMatrix[stock1][stock2] = isNaN(corr) ? 0 : corr;
                }
            });
        });

        displayMatrix();
        updateStats();
        updateApiStatus('online');
        showMessage('success', `✅ Correlation matrix updated successfully!`);
    } catch (error) {
        console.error('Error creating correlation matrix:', error);
        showMessage('error', `❌ Error: ${error.message}`);
        updateApiStatus('offline');
    }
}

// --- UI Rendering ---
function displayMatrix() {
    const allStocks = appState.preferredStocks;
    let html = '<table class="matrix-table">';
    html += '<tr><th></th>';
    allStocks.forEach(stock => {
        html += `<th>${stock} ${!appState.stockDataCache[stock] ? '⚠️' : ''}</th>`;
    });
    html += '</tr>';
    allStocks.forEach(stock1 => {
        if (!appState.correlationMatrix[stock1]) return;
        html += `<tr><th>${stock1}</th>`;
        allStocks.forEach(stock2 => {
            if (appState.correlationMatrix[stock1]?.[stock2] === undefined) {
                html += `<td>-</td>`;
            } else {
                const correlation = appState.correlationMatrix[stock1][stock2];
                const color = getCorrelationColor(correlation);
                html += `<td class="correlation-cell" style="background-color: ${color};" 
                        onclick="selectPair('${stock1}', '${stock2}')">
                        ${correlation.toFixed(3)}</td>`;
            }
        });
        html += '</tr>';
    });
    html += '</table>';
    document.getElementById('matrixContent').innerHTML = html;
}

// YENİ: Detaylı Analiz Panelini Oluşturan Ana Fonksiyon
async function selectPair(stock1, stock2) {
    const pairAnalysisDiv = document.getElementById('pairAnalysis');
    pairAnalysisDiv.innerHTML = `
        <div id="pairAnalysisContainer">
            <div class="price-chart-container" id="priceChart">
                <div class="loading-spinner"></div>
            </div>
            <div class="stock-details-container" id="stockDetails">
                <div class="loading-spinner"></div>
            </div>
        </div>`;

    // Grafik anında oluşturulabilir
    document.getElementById('priceChart').innerHTML = generatePriceChart(stock1, stock2);

    // Detaylar API'den çekilir
    const [details1, details2] = await Promise.all([
        fetchStockDetails(stock1),
        fetchStockDetails(stock2)
    ]);
    
    document.getElementById('stockDetails').innerHTML = renderStockDetails(stock1, stock2, details1, details2);
}

// YENİ: Finansal Veri Tablosunu Oluşturur
function renderStockDetails(symbol1, symbol2, details1, details2) {
    const data1 = appState.stockDataCache[symbol1];
    const data2 = appState.stockDataCache[symbol2];
    
    // 30 günlük en düşük/yüksek verisini anlık hesapla
    const last30Prices1 = data1 ? data1.slice(-30).map(d => d.price) : [];
    const last30Prices2 = data2 ? data2.slice(-30).map(d => d.price) : [];
    
    const metrics1 = {
        'Current Price': details1?.price?.regularMarketPrice?.fmt,
        'Current Yield': details1?.summaryDetail?.trailingAnnualDividendYield?.fmt,
        'EPS (TTM)': details1?.defaultKeyStatistics?.trailingEps?.fmt,
        'Market Cap': details1?.price?.marketCap?.fmt,
        'Enterprise Value': details1?.defaultKeyStatistics?.enterpriseValue?.fmt,
        '30d Low': last30Prices1.length > 0 ? Math.min(...last30Prices1).toFixed(2) : 'N/A',
        '30d High': last30Prices1.length > 0 ? Math.max(...last30Prices1).toFixed(2) : 'N/A',
    };
    const metrics2 = {
        'Current Price': details2?.price?.regularMarketPrice?.fmt,
        'Current Yield': details2?.summaryDetail?.trailingAnnualDividendYield?.fmt,
        'EPS (TTM)': details2?.defaultKeyStatistics?.trailingEps?.fmt,
        'Market Cap': details2?.price?.marketCap?.fmt,
        'Enterprise Value': details2?.defaultKeyStatistics?.enterpriseValue?.fmt,
        '30d Low': last30Prices2.length > 0 ? Math.min(...last30Prices2).toFixed(2) : 'N/A',
        '30d High': last30Prices2.length > 0 ? Math.max(...last30Prices2).toFixed(2) : 'N/A',
    };

    const createColumn = (symbol, metrics) => `
        <div class="details-column">
            <h5 style="color:${symbol === symbol1 ? '#00d4ff' : '#00ff88'}; border-color:${symbol === symbol1 ? '#00d4ff' : '#00ff88'};">${symbol}</h5>
            ${Object.entries(metrics).map(([label, value]) => `
                <div class="detail-item">
                    <span class="label">${label}</span>
                    <span class="value">${value || 'N/A'}</span>
                </div>
            `).join('')}
        </div>`;

    return createColumn(symbol1, metrics1) + createColumn(symbol2, metrics2);
}

function generatePriceChart(stock1, stock2) { /* Bu fonksiyon önceki kod ile aynı, buraya eklenebilir */ 
    const data1 = appState.stockDataCache[stock1];
    const data2 = appState.stockDataCache[stock2];
    if (!data1 || !data2) return '<div>Price data not available for chart.</div>';
    const { prices1, prices2 } = alignDataForCorrelation(data1, data2);
    if (prices1.length < 2) return '<div>Not enough common data points to draw chart.</div>';
    const allPrices = [...prices1, ...prices2];
    const minPrice = Math.min(...allPrices);
    const maxPrice = Math.max(...allPrices);
    const priceRange = maxPrice - minPrice === 0 ? 1 : maxPrice - minPrice;
    const width = 500, height = 300, padding = 40;
    const normalizeY = (price) => height - padding - ((price - minPrice) / priceRange) * (height - 2 * padding);
    const normalizeX = (index) => padding + (index / (prices1.length - 1)) * (width - 2 * padding);
    const path1 = prices1.map((p, i) => `${i === 0 ? 'M' : 'L'} ${normalizeX(i)} ${normalizeY(p)}`).join(' ');
    const path2 = prices2.map((p, i) => `${i === 0 ? 'M' : 'L'} ${normalizeX(i)} ${normalizeY(p)}`).join(' ');
    
    return `
    <svg viewBox="0 0 ${width} ${height}">
        <line x1="${padding}" y1="${height - padding}" x2="${width - padding}" y2="${height - padding}" stroke="#555" />
        <line x1="${padding}" y1="${padding}" x2="${padding}" y2="${height - padding}" stroke="#555" />
        <path d="${path1}" fill="none" stroke="#00d4ff" stroke-width="2" />
        <path d="${path2}" fill="none" stroke="#00ff88" stroke-width="2" />
        <text x="${padding + 5}" y="${padding - 15}" fill="#00d4ff" font-size="12">${stock1}</text>
        <text x="${padding + 5}" y="${padding}" fill="#00ff88" font-size="12">${stock2}</text>
        <text x="${padding}" y="${padding - 5}" fill="#fff" font-size="10" text-anchor="middle">${maxPrice.toFixed(2)}</text>
        <text x="${padding}" y="${height - padding + 15}" fill="#fff" font-size="10" text-anchor="middle">${minPrice.toFixed(2)}</text>
    </svg>`;
}

function updateStats() {
    const correlations = [], stocks = Object.keys(appState.correlationMatrix);
    stocks.forEach(s1 => stocks.forEach(s2 => {
        if (s1 < s2) correlations.push(appState.correlationMatrix[s1][s2]);
    }));
    if (correlations.length === 0) return;
    const avg = correlations.reduce((a, b) => a + b, 0) / correlations.length;
    document.getElementById('statsContainer').innerHTML = `
        <div class="stat-card"><div class="stat-value">${avg.toFixed(3)}</div><div class="stat-label">Avg Correlation</div></div>
        <div class="stat-card"><div class="stat-value">${Math.max(...correlations).toFixed(3)}</div><div class="stat-label">Highest Correlation</div></div>
        <div class="stat-card"><div class="stat-value">${Math.min(...correlations).toFixed(3)}</div><div class="stat-label">Lowest Correlation</div></div>
        <div class="stat-card"><div class="stat-value">${correlations.filter(c => c >= 0.7).length}</div><div class="stat-label">Strong Pos Pairs</div></div>
        <div class="stat-card"><div class="stat-value">${correlations.filter(c => c <= -0.7).length}</div><div class="stat-label">Strong Neg Pairs</div></div>
        <div class="stat-card"><div class="stat-value">${stocks.length}</div><div class="stat-label">Analyzed Stocks</div></div>`;
}

// --- Event Handlers & Initializers ---
function getCorrelationColor(v) {
    if (v >= 0.7) return '#00b894'; if (v >= 0.3) return '#6c5ce7';
    if (v >= -0.3) return '#fdcb6e'; if (v >= -0.7) return '#ff7675';
    return '#ff4757';
}
function updateApiStatus(status) { document.getElementById('apiStatus').className = `api-status status-${status}`; }
function showMessage(type, message) {
    const msgDiv = document.getElementById('apiMessage');
    msgDiv.innerHTML = `<div class="${type}">${message}</div>`;
    setTimeout(() => { msgDiv.innerHTML = ''; }, 5000);
}
function useRealData() {
    appState.useDemo = false; appState.isApiReady = true; updateApiStatus('online');
    showMessage('success', 'Yahoo Finance API activated! Click "Refresh Data".');
    document.getElementById('refreshBtn').disabled = false;
}
function useDemoData() {
    appState.useDemo = true; appState.isApiReady = true; updateApiStatus('online');
    showMessage('success', 'Demo data mode activated. Click "Refresh Data".');
    document.getElementById('refreshBtn').disabled = false;
}
function addCustomStock() {
    const ticker = document.getElementById('customTicker').value.trim().toUpperCase();
    if (ticker && !appState.preferredStocks.includes(ticker)) {
        appState.preferredStocks.push(ticker);
        document.getElementById('customTicker').value = '';
        showMessage('success', `${ticker} added to analysis list.`);
    }
}
async function refreshMatrix() {
    if (!appState.isApiReady) {
        showMessage('error', 'Please select a data source first.'); return;
    }
    document.getElementById('refreshBtn').disabled = true;
    await createCorrelationMatrix();
    document.getElementById('refreshBtn').disabled = false;
}

// Demo data generators
function generateDemoPriceData(period) {
    const timeSeries = [], today = new Date();
    let price = 25 + Math.random() * 50;
    for (let i = 0; i < period; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() - (period - 1 - i));
        price *= (1 + (Math.random() - 0.48) * 0.05);
        timeSeries.push({ timestamp: date.getTime(), price: Math.round(price * 100) / 100 });
    }
    return timeSeries;
}
function generateDemoDetails(symbol) {
    const random = (base, spread) => (base + (Math.random() - 0.5) * spread);
    return {
        price: { regularMarketPrice: { fmt: random(25, 10).toFixed(2) }, marketCap: { fmt: `${random(50, 20).toFixed(1)}B` } },
        summaryDetail: { trailingAnnualDividendYield: { fmt: `${random(6, 2).toFixed(2)}%` } },
        defaultKeyStatistics: { trailingEps: { fmt: random(1.5, 1).toFixed(2) }, enterpriseValue: { fmt: `${random(70, 30).toFixed(1)}B` } }
    };
}
</script>
</body>
</html>
